<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Today's Events</title>
  <style>
    body {
      background: #000;
      color: white;
      font-family: sans-serif;
      padding: 20px;
    }

    .card {
      display: flex;
      align-items: center;
      background: #1c1c1e;
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 20px;
    }

    .event-details {
      flex: 1;
    }

    .timer-container {
      position: relative;
      width: 80px;
      height: 80px;
    }

    svg {
      transform: rotate(-90deg);
    }

    .circle-bg {
      fill: none;
      stroke: #444;
      stroke-width: 6;
    }

    .circle {
      fill: none;
      stroke-width: 6;
      stroke-linecap: round;
      transition: stroke-dashoffset 0.5s linear;
    }

    .timer-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 0.8em;
      text-align: center;
    }
  </style>
</head>
<body>

  <div id="events-container">
    <!-- Cards will be populated here -->
  </div>

  <script>
    const FULL_CIRCLE = 2 * Math.PI * 30;

    const sampleEvent = {
      "event name": "Sample Event",
      "date": new Date().toISOString().split('T')[0], // today
      "time": "23:59",
      "end time": "23:59",
      "venue": "Test Location",
      "registration link": ""
    };

    function createEventCard(event) {
      const card = document.createElement('div');
      card.className = 'card';

      const timerHTML = `
        <div class="timer-container">
          <svg width="80" height="80">
            <circle class="circle-bg" cx="40" cy="40" r="30"/>
            <circle class="circle" cx="40" cy="40" r="30"/>
          </svg>
          <div class="timer-text">--</div>
        </div>`;

      card.innerHTML = `
        <div class="event-details">
          <h3>${event["event name"]}</h3>
          <p>${event.date} ${event.time}</p>
          <p>${event.venue}</p>
        </div>
        ${timerHTML}
      `;

      document.getElementById('events-container').appendChild(card);
      initTimer(card, event);
    }

    function initTimer(card, event) {
      const circle = card.querySelector(".circle");
      const timerText = card.querySelector(".timer-text");
      circle.style.strokeDasharray = FULL_CIRCLE;

      const startTime = new Date(`${event.date}T${event.time}`);
      const endTime = event["end time"]
        ? new Date(`${event.date}T${event["end time"]}`)
        : new Date(startTime.getTime() + 60 * 60 * 1000); // +1 hour

      const totalSeconds = (startTime - new Date()) / 1000;

      function update() {
        const now = new Date();

        if (now < startTime) {
          const secondsLeft = (startTime - now) / 1000;
          const progress = Math.min(secondsLeft / totalSeconds, 1);
          circle.style.stroke = "orange";
          circle.style.strokeDashoffset = FULL_CIRCLE * (1 - progress);

          const h = Math.floor(secondsLeft / 3600);
          const m = Math.floor((secondsLeft % 3600) / 60);
          timerText.textContent = `${h}h ${m}m`;

        } else if (now >= startTime && now < endTime) {
          timerText.textContent = "Live";
          circle.style.stroke = "limegreen";
          circle.style.strokeDashoffset = 0;
        } else {
          timerText.textContent = "Ended";
          circle.style.stroke = "red";
          circle.style.strokeDashoffset = 0;
        }
      }

      update();
      setInterval(update, 1000);
    }

    // Replace this with your own event loading logic
    createEventCard(sampleEvent);
  </script>

</body>
</html>
